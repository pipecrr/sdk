@using Siesa.SDK.Frontend.Application
@using Siesa.SDK.Shared.Services
@inject IResourceManager ResourceManager
@inject IAuthenticationService AuthenticationService

@Text

@code {
    [Parameter] public string ResourceTag { get; set; }
    [Parameter] public Int64? RowidResource { get; set; }

    [Parameter] public Int64 RowidCulture { get; set; }

    private string Text { get; set; }

    private async Task<string> GetText(){
        if(!String.IsNullOrEmpty(ResourceTag)){
            if(RowidCulture != 0 && (AuthenticationService == null || AuthenticationService.User == null || AuthenticationService.GetRoiwdCulture() == 0)){
                return await ResourceManager.GetResource(ResourceTag, RowidCulture);
            }else{
                return await ResourceManager.GetResource(ResourceTag, AuthenticationService);
            }
        }
        if(RowidResource != 0 && RowidResource != null){
            if(RowidCulture != 0 && (AuthenticationService == null || AuthenticationService.User == null || AuthenticationService.GetRoiwdCulture() == 0)){
                return await ResourceManager.GetResource(Convert.ToInt64(RowidResource), RowidCulture);
            }else{
                return await ResourceManager.GetResource(Convert.ToInt64(RowidResource), AuthenticationService);
            }
        }
        return Text;
    }

    protected override async Task OnInitializedAsync()
    {
        Text = ResourceTag;
        await base.OnInitializedAsync();
        Text = await GetText();
    }

    protected override async Task OnParametersSetAsync()
    {
        Text = ResourceTag;
        await base.OnParametersSetAsync();
        Text = await GetText();
    }
}

