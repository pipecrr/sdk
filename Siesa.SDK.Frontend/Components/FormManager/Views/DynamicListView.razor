@page "/{BusinessName}/"
@attribute [Authorize]
@using Microsoft.AspNetCore.Authorization
@inherits Siesa.SDK.Frontend.Components.FormManager.ViewModels.DynamicBaseViewModel
@if (ErrorMsg != null && ErrorMsg != "")
{
    <text>@ErrorMsg</text>
}
else if (BusinessObj != null)
{
    <DynamicComponent Type="@componentType" Parameters="@parameters" />
}

@code {
    [Parameter] public bool IsSubpanel { get; set; }
    [Parameter] public string SubpanelFilter { get; set; }
    private Type componentType = typeof(Views.ListView);
    private IDictionary<string, object> parameters = new Dictionary<string, object>();
    private void SetParameters(dynamic businessObj, string businessName){
        parameters.Clear();
        parameters.Add("BusinessObj", businessObj);
        parameters.Add("BusinessName", businessName);
        if (IsSubpanel)
        {
            parameters.Add("SetTopBar", false);
            parameters.Add("ConstantFilters", new List<string>() { SubpanelFilter });
        }
    }

    protected override void OnInitialized()
    {
        base.OnInitialized();
        SetParameters(BusinessObj, BusinessName);
    }

    protected override void OnParametersSet()
    {
        base.OnParametersSet();
        SetParameters(BusinessObj, BusinessName);        
    }
    
}