@page "/{BusinessName}/"
@attribute [Authorize]
@using Microsoft.AspNetCore.Authorization
@inherits Siesa.SDK.Frontend.Components.FormManager.ViewModels.DynamicBaseViewModel
@if (ErrorMsg != null && ErrorMsg != "")
{
    <text>@ErrorMsg</text>
}
else if (BusinessObj != null)
{
    <DynamicComponent Type="@(typeof(Views.ListView))" Parameters="@parameters" />
}

@code {
    [Parameter] public string SubpanelFilter { get; set; }

    [Parameter] public Action<string> OnClickEdit { get; set; } = null;
    [Parameter] public Action<string> OnClickDetail { get; set; } = null;
    [Parameter] public Action<string,string> OnClickDelete { get; set; } = null;

        
    protected override void SetParameters(dynamic businessObj, string businessName){
        parameters.Clear();
        parameters.Add("BusinessObj", businessObj);
        parameters.Add("BusinessName", businessName);
        if (IsSubpanel)
        {
            parameters.Add("IsSubpanel", true);
            parameters.Add("SetTopBar", false);
            parameters.Add("ConstantFilters", new List<string>() { SubpanelFilter });
            parameters.Add("ViewdefName", "related_list");
            if (OnClickEdit != null)
            {
                parameters.Add("OnClickEdit", OnClickEdit);
            }
            if (OnClickDetail != null)
            {
                parameters.Add("OnClickDetail", OnClickDetail);
            }
            if (OnClickDelete != null)
            {
                parameters.Add("OnClickDelete", OnClickDelete);
            }
        }
    }
}