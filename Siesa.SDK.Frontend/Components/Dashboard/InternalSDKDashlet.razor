@using Siesa.SDK.Frontend.Components.Visualization 
@using Microsoft.Extensions.DependencyInjection  
@using Microsoft.AspNetCore.Components 
@using Siesa.SDK.Frontend.Components.Layout
@using Siesa.SDK.Shared.Services

@inject IAuthenticationService AuthenticationService
@inject IServiceProvider ServiceProvider


    <div class="col py-3 h-100">
        <div class="sdk-dashlet">
            <ErrorBoundary @ref="errorBoundary">
                <ChildContent>
                    @GetDashlet()?.Title
                    <DynamicComponent Type="@Item" @ref="DynamicComponentRef" />
                </ChildContent> 
                <ErrorContent Context="Exception" >
                    <div class="col-12 text-center font_color_primary_dark py-5">
                        <i class="fa-solid fa-triangle-exclamation fa-3x"></i>
                        <p class="mt-3">
                            <ResourceViewer ResourceTag="Custom.Generic.Message.Error" 
                            RowidCulture=@AuthenticationService.GetRoiwdCulture()/>
                        </p>
                    </div>
                </ErrorContent>
            </ErrorBoundary>
        </div>
    </div>



@code {
    [Parameter]
    public Type Item { get; set; }

    private Microsoft.AspNetCore.Components.DynamicComponent DynamicComponentRef { get; set; }
    private ErrorBoundary? errorBoundary;


    protected override async Task OnInitializedAsync()
    {
        await base.OnInitializedAsync();
    }

    private SDKDashlet GetDashlet()
    {
        if(DynamicComponentRef == null)
        {
            return null;
        }

        return DynamicComponentRef.Instance as SDKDashlet;
    }

    /*private string GetWidth()
    {
        return Item.Width switch
        {
            SDKDashletWidth.Full => "100%",
            SDKDashletWidth.Half => "50%",
            SDKDashletWidth.Third => "33.33%",
            SDKDashletWidth.Quarter => "25%",
            _ => "25%"
        };
    }*/
}