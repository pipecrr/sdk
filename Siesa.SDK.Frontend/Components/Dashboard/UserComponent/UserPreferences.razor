@using Siesa.SDK.Frontend.Components.Layout
@using Siesa.SDK.Frontend.Components.FormManager.Views
@using Siesa.SDK.Shared.Services
@using Siesa.SDK.Frontend.Components.FormManager
@using Siesa.SDK.Shared.Utilities
@using Microsoft.Extensions.DependencyInjection
@using Siesa.SDK.Shared.DTOS
@using Siesa.SDK.Frontend.Components.FormManager.ViewModels

@inject IServiceProvider ServiceProvider
@inject IAuthenticationService AuthenticationService
@inject IBackendRouterService BackendRouterService
@inject SDKDialogService DialogService



<div class="row">
    <div
        class="container-foto-perfil d-flex align-items-center justify-content-center col-12 col-sm-12 col-md-4 col-lg-3">

        <div class="whcm_user_photo_box">
            <div class="whcm_user_photo">
                <img src="@ProfileImageData" alt="imagen perfil" style="max-width: 100%;">
            </div>
            <button class="whcm_upload_photo btn btn-primary btn_primary_def_1 btn-sm" data-toggle="tooltip"
                data-placement="top" title="" data-original-title="Preferencias_Usuario">
                <i class="fa-solid fa-camera"></i>
            </button>
        </div>

    </div>

    <div class="col-12 col-sm-12 col-md-8 col-lg-9 mt-3">
        <div class="sdk_card d-flex flex-row">
            <div class="sdk_button_box_2 p-1">

                @if (_IsEdit)
                {
                    <button class="btn btn-sm layout_btn_negative-sm mb-1" data-toggle="tooltip" data-placement="top"
                        title="Editar" @onclick="@(()=> ChangeViewType())">
                        <i class="fa-solid fa-circle-check"></i>
                    </button>

                    <button class="btn btn-sm layout_btn_negative-sm mb-1" data-toggle="tooltip" data-placement="top"
                        title="Editar" @onclick="@(()=> ChangeViewType())">
                        <i class="fa-solid fa-ban"></i>
                    </button>
                }
                else
                {
                    <button class="btn btn-sm layout_btn_negative-sm mb-1" data-toggle="tooltip" data-placement="top"
                        title="Editar" @onclick="@(()=> ChangeViewType())">
                        <i class="fa-solid fa-pen"></i>
                    </button>
                }

            </div>
            <div class="col pt-2">
                <div class="row">

                    <h6 class="col-12 font-weight-bold">
                        <ResourceViewer ResourceTag="Custom.SDK.UserPreference.UserData" />
                    </h6>

                    <FreeForm Viewdef="user_preferences" BusinessName="BLUser" BusinessObj="@BLUser"
                        ViewContext="@DynamicViewType" />

                </div>
            </div>
        </div>
    </div>
</div>
<hr>

<div class="row">
        <div class="col-12 col-sm-12 mb-sm-3  col-md-12 col-lg-4 mb-lg-0 custom-border custom-border-2">
            <h6 class="col-12 font-weight-bold font_color_primary p-0 form-group">
                <ResourceViewer ResourceTag="Custom.SDK.UserPreference.Themes" />
            </h6>

            <div class="col px-0 mb-3">
                <label class="col-12 font-weight-bold p-0">
                    <ResourceViewer ResourceTag="Custom.SDK.UserPreference.MainThemes" />
                </label>

                <div id="carouselExampleControls" class="carousel slide" data-interval="false">
                    <div class="carousel-inner">
                        <div class="carousel-item active">
                            <div class="row px-4" alt="First slide">
                                @if (_userPreferences != null && _userPreferences.ThemeColor != null)
                                { 
                                    @foreach (var theme in _userPreferences.ThemeColor)
                                    {
                                        <div class="col-4 ">
                                            <div class="sdk_card p-2 mb-2">
                                                <div class="d-flex justify-content-between">
                                                    <div class="col-12 pl-0 pr-0">
                                                        <div
                                                            style="background-color:@theme.Value; border-radius: 4px; height: 20px;">
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="d-flex align-items-center">
                                                <input class="mr-2" type="radio" name="ThemeColor" value="@theme.Value">
                                                <label class="mb-0"  style="font-size: 14px;">@theme.Key</label>
                                            </div>
                                        </div>
                                    }
                                }
                            </div>
                        </div>
                    </div>

                    <a class="carousel-control-prev" href="#carouselExampleControls" role="butto" style="opacity: 1;width: auto;"
                        data-slide="prev">
                        <span class="carousel-control-prev-icon" aria-hidden="true">
                            <i class="fa-solid fa-chevron-left" style="color:#1079FD"></i>
                        </span>
                        <span class="sr-only">Previous</span>
                    </a>
                    <a class="carousel-control-next" href="#carouselExampleControls" role="button" style="opacity: 1;width: auto;"
                        data-slide="next">
                        <span class="carousel-control-next-icon" aria-hidden="true">
                            <i class="fa-solid fa-chevron-right" style="color:#1079FD;"></i>
                        </span>
                        <span class="sr-only">Next</span>
                    </a>
                </div>
             </div>
             
            <div class="col px-0 mb-3">
                <label class="col-12 font-weight-bold p-0">
                    <ResourceViewer ResourceTag="Custom.SDK.UserPreference.ComplementaryColor" />
                </label>

                <div class="row">
                    @if (_userPreferences != null && _userPreferences.ComplementaryColors != null)
                    {
                        @foreach (var item in _userPreferences.ComplementaryColors)
                        {   
                            <div class="col-4 ">
                                    <div class="sdk_card p-2 mb-2">
                                        <div class="d-flex justify-content-between">

                                            <div class="col-6 pl-0 pr-1">
                                                <div
                                                    style="background-color:@item.PrimaryColor; border-radius: 4px; height: 20px;">
                                                </div>
                                            </div>

                                            <div class="col-6 pr-0 pl-1">
                                                <div
                                                    style="background-color:@item.SecundaryColor; border-radius: 4px; height: 20px;">
                                                </div>
                                            </div>

                                        </div>

                                    </div>

                                    <div class="d-flex align-items-center">
                                        <input class="mr-2" type="radio" name="ComplementartColor" value="@item.ColorName">
                                        <label class="mb-0" style="font-size: 14px;">@item.ColorName</label>
                                    </div>

                            </div>
                        }
                    }
                </div>
            </div>

            <div class="alert alert-info d-flex align-items-center font_size_087" role="alert">
                <i class="fa-solid fa-circle-info mr-2"></i>
                 <ResourceViewer ResourceTag="Custom.SDK.UserPreference.Notifi" />
            </div>
        </div>
             

    <div class="col-12 col-sm-12 mb-sm-3  col-md-12 col-lg-4 mb-lg-0 custom-border custom-border-2">

        <h6 class="col-12 font-weight-bold font_color_primary p-0 form-group">
        <ResourceViewer ResourceTag="Custom.SDK.UserPreference.IconStyle" />
        </h6>
        <div class="row">
            <div class="col-12 col-sm-12">
                <div class="row">
                    @if (_userPreferences != null && _userPreferences.IconStyle != null)
                    {    
                        @foreach (var icon in _userPreferences.IconStyle)
                        {    
                            <div class="col-4 mb-3">
                                <div class="sdk_card d-flex justify-content-center rounded p-4 mb-2">
                                    <i class="@icon.Value" style="color:#1079FD;"></i>
                                </div>

                                <div class="d-flex align-items-center">
                                    <input class="mr-2" type="radio" name="IconStyle"  value="@icon.Value">
                                    <label class="mb-0"  style="font-size: 14px;">@icon.Key</label>
                                </div>
                            </div>
                        }
                    }
                </div>

            </div>

        </div>
    </div>

    <div class="col-12 col-sm-12 col-md-12 col-lg-4">

        <h6 class="col-12 font-weight-bold font_color_primary p-0 form-group">Barra de Herramientas</h6>

        <div class="row">

            <div class="col-12 mb-3">
                <div class="d-flex justify-content-center py-4 px-5 mb-2 sdk_card">
                    <div class="col-12 col-md-10 col-lg-12 d-flex d-row justify-content-around">
                        <i class="fa-solid fa-circle-plus fa-lg" style="color:#1079FD;"></i>
                        <i class="fa-solid fa-pen fa-lg" style="color:#1079FD;"></i>
                        <i class="fa-solid fa-trash-can fa-lg" style="color:#1079FD;"></i>
                        <i class="fa-solid fa-list fa-lg" style="color:#1079FD;"></i>
                        <i class="fa-solid fa-magnifying-glass fa-lg" style="color:#1079FD;"></i>
                    </div>

                </div>

                <div class="d-flex align-items-center">
                    <input class="mr-2" type="radio" id="1color" value="1 Color">
                    <label class="mb-0" for="1color" style="font-size: 14px;">1 Color</label>
                </div>
            </div>

            <div class="col-12 ">
                <div class="d-flex justify-content-center py-4 px-5 mb-2 sdk_card">
                    <div class="col-12 col-md-10 col-lg-12 d-flex d-row justify-content-around">
                        <i class="fa-solid fa-circle-plus fa-lg" style="color:#FA8651;"></i>
                        <i class="fa-solid fa-pen fa-lg" style="color:#FAC153;"></i>
                        <i class="fa-solid fa-trash-can fa-lg" style="color:#F9777F;"></i>
                        <i class="fa-solid fa-list fa-lg" style="color:#C0AAEF;"></i>
                        <i class="fa-solid fa-magnifying-glass fa-lg" style="color:#2BC8C9;"></i>
                    </div>

                </div>

                <div class="d-flex align-items-center">
                    <input class="mr-2" type="radio" id="multicolor" value="Multicolor">
                    <label class="mb-0" for="multicolor" style="font-size: 14px;">Multicolor</label>

                </div>
            </div>

        </div>
    </div>
</div>



<div class="row modal-footer pb-0">
    <button class="btn btn-primary btn_secondary_def_1 btn-sm px-3" @onclick="@(async () => await InitView())">
      <ResourceViewer ResourceTag="Custom.SDK.UserPreference.DiscardChanges" />
    </button>


    <button class="btn btn-primary btn_secondary_cancel btn-sm px-3" @onclick="@(()=> DialogService.Close(false))" >
        <ResourceViewer ResourceTag="Custom.SDK.UserPreference.Out" />
    </button>

    <button class="btn btn-primary btn_primary_def_1 btn-sm px-3" @onclick="@(async () => await SaveUserPreferences())">
        <ResourceViewer ResourceTag="Action.Save" />
    </button>


</div>

@code
{
    private string ProfileImageData { get; set; }
    private bool _IsEdit = false;
    public DynamicViewType DynamicViewType { get; set; } = DynamicViewType.Detail;
    public dynamic BLUser { get; set; }

    private UserPreferencesDTO _userPreferences { get; set; }

    private void ChangeViewType()
    {
        _IsEdit = !_IsEdit;

        if (_IsEdit)
        {
            DynamicViewType = DynamicViewType.Edit;
        }
        else
        {
            DynamicViewType = DynamicViewType.Detail;
        }

        StateHasChanged();
    }

    private async Task InitView()
    {
        var blType = Utilities.SearchType("Siesa.MasterBackend.Business.BLUser");

        BLUser = ActivatorUtilities.CreateInstance(ServiceProvider, blType);

        await BLUser.InitializeBusiness(AuthenticationService.User.Rowid);

        BLUser.BusinessName = "BLUser";

        ProfileImageData = AuthenticationService.GetUserPhoto();

        //TODO: _userPreferences 

        _userPreferences = new UserPreferencesDTO() 
        {
            ThemeColor = new Dictionary<string, string>() 
            {
                { "Azul Siesa", "#1079FD" },
                { "Naranja", "#00AE3C" },
                { "Verde", "#FF8E2C" },
            },
            IconStyle = new Dictionary<string, string>() 
            {
                { "Solid", "fa-solid fa-user fa-2x" },
                { "Regular", "fa-regular fa-user fa-2x" },
                { "Light", "fa-light fa-user fa-2x" },
                { "Duotone", "fa-duotone fa-user fa-2x" },
            },
            ComplementaryColors = new List<ComplementaryColor>()
            {
                new ComplementaryColor() { ColorName = "Tono1", PrimaryColor = "#9B111E", SecundaryColor="#4C2882"  },
                new ComplementaryColor() { ColorName = "Tono2", PrimaryColor = "#4C2882", SecundaryColor="#9B111E" }
            }
            
        };

        StateHasChanged();
    }

    protected override async Task OnInitializedAsync()
    {
        await InitView();

        await base.OnInitializedAsync();
    }

    private async Task SaveUserPreferences()
    {
        var BL = BackendRouterService.GetSDKBusinessModel("BLUser",AuthenticationService);

        var result = await BL.Call("SaveUserPreferences", BLUser.BaseObj );

        if (result.Success)
        {
            Console.WriteLine("Success Save Changes");
            DialogService.Close(true)
        }

    }
}